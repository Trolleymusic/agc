// agc
// http://github.com/Trolleymusic/agc
;(function(a){a.fn.agc=(function(b){var c=(function(h,g){var k,j,f,d,e,i;this.Make=function(l,m){var n;m=m||{};k=(l||m.carousel);if(!k.length){return}n=this;d=m;this.Build();e=(m.controls||k);n.Prev=m.prev||n.Prev;e.on("click",'a[href="#prev"]',function(o){o.preventDefault();n.Prev.apply(n,[o,k,this])});n.Next=m.next||n.Next;e.on("click",'a[href="#next"]',function(o){o.preventDefault();n.Next.apply(n,[o,k,this])});n.Close=m.close||n.Close;e.on("click",'a[href="#close"]',function(o){o.preventDefault();n.Close.apply(n,[o,k,this])});n.GoTo=m.goTo||n.GoTo;k.find("a").filter(function(){if(!a(this).attr("href")){return false}return a(this).attr("href").match(/\#\d+/)}).bind("click",function(o){o.preventDefault();o.stopPropagation();n.GoTo(parseInt(a(this).attr("href").replace("#",""),10)-1)});this.element=k;this.Enhance();this.Autoplay()};this.Build=function(){var l;l=false;j=k.children(":not(a)");j=j.filter(':not([data-no-touch="true"])');if(j.length==1&&j[0].tagName=="UL"&&j.children("li").length){j=j.children("li");l=true}j.each(function(m){a(this).attr("data-slide",m);if(!d.doNotArrange){a(this).css({left:(m*100)+"%"})}if(d.setZOrder){a(this).css({"z-index":(j.length-m)})}});f=l?j.parent():a(document.createElement("div"));f.addClass("carousel-container");f.css({position:"absolute",left:0,top:0,width:"100%",height:"100%"});f.appendTo(k);f.append(j);this.SetCurrent(0)};this.Enhance=function(){var m,l;m=this;l=this.element;if(Modernizr.touch){this.element.addClass("untouched");this.element.one("touchstart",function(){if(l.hasClass("untouched")){l.removeClass("untouched")}});l.on("swipeRight",function(n){m.Prev.apply(m,[n,k,this])});l.on("swipeLeft",function(n){m.Next.apply(m,[n,k,this])});l.on("swipeUp",function(n){m.Close.apply(m,[n,k,this])})}else{a(document).on("keyup",function(n){if(l.height()){if(n.which==37){m.Prev.apply(m,[n,k,this])}else{if(n.which==39){m.Next.apply(m,[n,k,this])}else{if(n.keyCode==27){m.Close.apply(m,[n,k,this])}}}}})}this.Transform(0)};this.Transform=function(l){if(d.doNotMove){return}if(Modernizr.csstransforms3d){f.get(0).style[Modernizr.prefixed("transform")]="translate3d("+l+",0,0)"}else{if(Modernizr.csstransforms){f.get(0).style[Modernizr.prefixed("transform")]="translate("+l+",0)"}else{f.css("left",l)}}};this.Move=function(l){var m;if(d.doNotScroll){return}m=(l*-100)+"%";this.Transform(m)};this.GetCurrent=function(){return parseInt(f.attr("data-current")||0,10)};this.GetCurrentAsObject=function(){return j.filter('[data-slide="'+this.GetCurrent()+'"]')};this.SetCurrent=function(l){f.attr("data-current",l);this.MarkSlides(l);this.ResetAutonext()};this.MarkSlides=function(l){var m;if(!d.mark){return}m=j.filter('[data-slide="'+l+'"]');if(d.mark.current){j.removeClass(d.mark.current);m.addClass(d.mark.current)}if(d.mark.next){j.removeClass(d.mark.next);m.next().addClass(d.mark.next)}if(d.mark.prev){j.removeClass(d.mark.prev);m.prev().addClass(d.mark.prev)}};this.FindASlide=function(l){return parseInt(j.filter(l).attr("data-slide")||-1,10)};this.FindASlideAsObject=function(l){return j.filter(l)};this.Next=function(){this.FnNext()};this.FnNext=function(){var l=this.GetCurrent();l=this.CalcNext(l);this.SetCurrent(l);this.Move(l)};this.CalcNext=function(l){return(l>=j.length-1)?0:l+1};this.Prev=function(){this.FnPrev()};this.FnPrev=function(){var l=this.GetCurrent();l=this.CalcPrev(l);this.SetCurrent(l);this.Move(l)};this.CalcPrev=function(l){return(l<=0)?j.length-1:l-1};this.GoToLink=function(l){var m;l=l.replace("#","");m=this.FindASlide("."+l);if(m==-1){return}this.SetCurrent(m);this.Move(m)};this.GoTo=function(l){this.GoToNumber(l)};this.GoToNumber=function(l){if(l<0||l>j.length){return}this.SetCurrent(l);this.Move(l)};this.Slides=function(){return j};this.Autoplay=function(){d.autoplay=d.autoplay||parseInt(k.data("autoplay"),10);if(!d.autoplay){return}this.Autonext()};this.ResetAutonext=function(){var l;if(d.autoplay){l=this;requestAnimationFrame(function(){l.Autonext()})}};this.Autonext=function(){var l=this;if(i){clearTimeout(i);i=null}i=setTimeout(function(){l.Next.apply(l,[null,k,this])},d.autoplay*1000)};this.Make(h,g);return this});return new c(this,b)})})(jQuery);